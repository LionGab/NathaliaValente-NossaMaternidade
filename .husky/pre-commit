#!/bin/bash

echo "Running pre-commit checks..."

# 1. TypeScript
echo "[1/4] TypeScript check..."
bun run typecheck || exit 1

# 2. ESLint
echo "[2/4] ESLint..."
bun run lint || exit 1

# 3. Design validation (if hook exists)
if [ -f ".claude/hooks/pre-commit-design.sh" ]; then
  echo "[3/4] Design validation..."
  bash .claude/hooks/pre-commit-design.sh || exit 1
else
  echo "[3/4] Design validation... (skipped - hook not found)"
fi

# 4. Security check - no exposed API keys
echo "[4/4] Security check..."
if grep -rn "sk-" src/ --include="*.ts" --include="*.tsx" 2>/dev/null | grep -v "// sk-" | head -1; then
  echo "ERROR: Possible API key exposure detected!"
  exit 1
fi

echo "All pre-commit checks passed!"
