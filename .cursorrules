# Nossa Maternidade — Cursor Rules

# Otimizado para MacBook M1 8GB RAM

## Fonte da Verdade

- **Siga SEMPRE**: `CLAUDE.md` (regras críticas + comandos + arquitetura) como referência principal
- **Design System**: `src/theme/tokens.ts` é a fonte única de verdade para cores/tokens
- **Preset**: `src/theme/presets/calmFemtech.ts` (Calm FemTech - Azul + Rosa híbrido)

## Não-Negociáveis (Repo Contract)

### TypeScript

- TypeScript strict mode, **zero `any`** (use `unknown` + type guards)
- Proibido `@ts-ignore`/`@ts-expect-error` (só com justificativa explícita no PR)

### Logging

- **Usar `logger.*`** de `src/utils/logger.ts` (import: `import { logger } from '../utils/logger'`)
- **Proibido `console.log/error/warn`** (exceto no próprio logger.ts)
- Padrão: `logger.info('mensagem', 'contexto', metadata?)`

### UI e Design System

- **Cores**: usar `useThemeColors()` hook OU `Tokens.*` de `src/theme/tokens.ts`
- **Proibido cores hardcoded**: `#xxx`, `rgba()`, `'white'`, `'black'` (exceto em casos documentados)
- **Overlays**: usar `Tokens.overlay.light/medium/dark/heavy/backdrop`
- **Shadows**: usar `Tokens.neutral[900]` como `shadowColor`
- **Design System**: APENAS `src/theme/tokens.ts` (NÃO usar `src/design-system/` diretamente)
- **Preset**: usar `useTheme().preset` para tokens do Calm FemTech

### Acessibilidade

- **WCAG AAA** por padrão (contraste 7:1, touch targets 44pt+)
- Sempre `accessibilityLabel` e `accessibilityRole`
- `minHeight: 44pt` para elementos interativos

### Performance

- **Listas**: usar `FlatList` ou `FlashList` (NUNCA `ScrollView + map()`)
- **Memoização**: usar `memo()` quando render repetitivo
- **Lazy loading**: componentes grandes devem ser lazy-loaded

### Services e API

- **Padrão de retorno**: `{ data, error }` (sem try/catch espalhado)
- **Supabase**: nunca desabilitar RLS (Row Level Security)
- **IA**: seguir padrões em `src/api/chat-service.ts` (OpenAI/Grok)

### Arquitetura

- **Imports não utilizados**: prefixar com `_` (ex: `AgentContext as _AgentContext`)
- **Zustand selectors**: usar selectores individuais (evitar objeto que cria nova ref)

  ```typescript
  // ✅ BOM: selector individual
  const user = useAppStore((s) => s.user);

  // ❌ RUIM: objeto cria nova ref
  const { user } = useAppStore((s) => ({ user: s.user }));
  ```

## Processo de Mudança (Qualidade e Risco)

### Escopo

- **Menor diff possível**: não mudar arquivos fora do escopo necessário
- **Arquivos > 250 LOC**: refatorar (extrair hooks/components/services)

### Breaking Changes

- Se houver risco de breaking change: propor plano incremental
- Estratégia: compatibilidade + migração + remoção do legado (na mesma PR quando possível)

### Dependências

- Não adicionar dependências sem esgotar o que já existe no projeto
- Verificar `package.json` antes de sugerir nova lib

### Segurança

- **Nunca tocar `.env*`** ou arquivos de configuração sensíveis
- Se precisar variável nova: informar nome + onde é lida + pedir confirmação

## Check Obrigatório Antes de Finalizar

Sempre executar na ordem:

1. **`npm run lint`** (ou `bun run lint`) - ESLint
2. **`npm run typecheck`** (ou `bun run typecheck`) - TypeScript (`tsc --noEmit`)
3. **`npm test`** (se houver testes) - Testes unitários
4. **Se mudou UI**: verificar manualmente Design System (cores, tokens, acessibilidade)
5. **Antes de build/deploy**: `npm run diagnose:production` (ou `bun run diagnose:production`)

### Quality Gate Completo

Para PRs e builds, usar: `npm run quality-gate` (ou `bun run quality-gate`)

- Executa: typecheck + lint + check-build-ready + verificação de console.log

## Stack Tecnológica

- **Expo SDK 54+** (managed workflow)
- **React Native 0.81+**
- **TypeScript 5.7+** strict
- **NativeWind 4+** (Tailwind para React Native)
- **React Navigation 7**
- **TanStack Query** (se usado)
- **Supabase** (auth/DB/storage)
- **Zustand** (state management)
- **Gemini 2.5 Flash** (IA principal, fallback GPT-4o/Claude via `src/api/chat-service.ts`)

## Otimizações para MacBook M1 8GB RAM

- Priorizar código eficiente e memoização quando necessário
- Evitar processamento pesado em main thread
- Usar lazy loading para componentes grandes
- Otimizar imports (tree-shaking)
- Preferir hooks nativos do React Native quando disponível

## Comunicação (Lion Mode)

- Sempre responder em **português do Brasil**
- Estilo: **assertivo, direto, sem floreio**
- Preferir **síntese** sobre verbosidade
- Quando modificar código: aplicar **atomic commits** e explicar racional técnico

## Referências Rápidas

- **CLAUDE.md**: arquitetura completa, comandos, padrões de código
- **src/theme/tokens.ts**: Design Tokens (fonte única de verdade)
- **src/hooks/useTheme.ts**: Hook para tema (light/dark) + tokens
- **src/utils/logger.ts**: Sistema de logging centralizado
- **src/state/store.ts**: Todos os stores Zustand
- **docs/**: Documentação técnica completa
- **docs/CURSOR_CLAUDE_SETUP.md**: Por que usar Claude no Cursor + configuração completa

## Agents Disponíveis (Claude Code / Cursor)

Use `@agent-name` para invocar:

- `@launch-helper` - Guidance para App Store/Google Play launch
- `@nathia-expert` - Validação de personalidade NathIA
- `@code-reviewer` - Review de qualidade de código

**Localização**: `.claude/agents/`

## Commands Disponíveis (Claude Code / Cursor)

Use `/command` para invocar:

- `/launch-status` - Mostrar status de preparação para launch
- `/design-check` - Verificar compliance com design system
- `/audit-colors` - Encontrar cores hardcoded

**Localização**: `.claude/commands/`

## Hooks Disponíveis

**Pre-commit Hooks**:
- `.claude/hooks/pre-commit-quality.sh` - Quality gate antes de commit
- `.claude/hooks/pre-commit-design.sh` - Validação de design system

**Auto-executam** via Husky em `git commit`

## MCP Servers Configurados

- **Supabase**: Database queries, migrations, schema
- **Context7**: Documentação atualizada de bibliotecas
- **Memory Keeper**: Contexto de sessão, continuidade
- **Playwright**: Automação de browser, screenshots
- **Sequential Thinking**: Raciocínio estruturado

**Configuração**: `.claude/mcp-config.json`

## Launch Preparation (App Stores)

Preparando lançamento no App Store + Google Play:

- **Plano**: `docs/PLANO_LANCAMENTO_10_DIAS.md` (1175 linhas, ultra-detalhado)
- **Script**: `./scripts/launch-checklist.sh` (executável CLI)
- **Status**: Código 95% pronto, blockers: RevenueCat dashboard, legal docs

**Valores Críticos (NUNCA alterar)**:
```
iOS Bundle: br.com.nossamaternidade.app
Android Package: com.nossamaternidade.app
Monthly Product: com.nossamaternidade.subscription.monthly
Annual Product: com.nossamaternidade.subscription.annual
Entitlement: "premium" (EXACT case-sensitive)
Offering: "default" (EXACT case-sensitive)
```

## Windows Support

Projeto suporta desenvolvimento Windows:
- Use **Git Bash** (não CMD/PowerShell) para scripts `.sh`
- EAS builds funcionam do Windows (cloud-based)
- Android Emulator funciona, iOS Simulator não (somente Mac)

**Guia completo**: `docs/WINDOWS_SETUP.md`
